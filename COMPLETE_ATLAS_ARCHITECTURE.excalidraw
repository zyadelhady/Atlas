{
  "type": "excalidraw",
  "version": 2,
  "source": "https://excalidraw.com",
  "elements": [
    {
      "type": "text",
      "id": "main-title",
      "x": 500,
      "y": 20,
      "width": 1200,
      "height": 50,
      "fontSize": 42,
      "fontFamily": 1,
      "text": "Atlas AI Agent - Complete Architecture",
      "textAlign": "center",
      "strokeColor": "#1e88e5",
      "fontWeight": "bold"
    },
    {
      "type": "rectangle",
      "id": "section1-border",
      "x": 50,
      "y": 100,
      "width": 700,
      "height": 1200,
      "strokeColor": "#43a047",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 4,
      "roundness": { "type": 3 },
      "strokeStyle": "dashed"
    },
    {
      "type": "text",
      "id": "section1-title",
      "x": 100,
      "y": 120,
      "width": 600,
      "height": 40,
      "fontSize": 32,
      "fontFamily": 1,
      "text": "DIAGRAM 1: Hybrid Search Flow",
      "textAlign": "center",
      "strokeColor": "#2e7d32",
      "fontWeight": "bold",
      "backgroundColor": "#c8e6c9"
    },
    {
      "type": "rectangle",
      "id": "query-box-1",
      "x": 250,
      "y": 200,
      "width": 300,
      "height": 60,
      "strokeColor": "#1e88e5",
      "backgroundColor": "#bbdefb",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roughness": 1,
      "opacity": 100,
      "roundness": { "type": 3 }
    },
    {
      "type": "text",
      "id": "query-text-1",
      "x": 270,
      "y": 215,
      "width": 260,
      "height": 30,
      "fontSize": 16,
      "fontFamily": 1,
      "text": "User Query:\n\"How do I merge DataFrames?\"",
      "textAlign": "center",
      "strokeColor": "#1e88e5"
    },
    {
      "type": "arrow",
      "id": "arrow-to-preprocess-1",
      "x": 400,
      "y": 260,
      "width": 0,
      "height": 40,
      "strokeColor": "#1e88e5",
      "strokeWidth": 2,
      "startArrowhead": null,
      "endArrowhead": "arrow",
      "points": [[0, 0], [0, 40]]
    },
    {
      "type": "rectangle",
      "id": "preprocess-box-1",
      "x": 200,
      "y": 320,
      "width": 400,
      "height": 100,
      "strokeColor": "#7b1fa2",
      "backgroundColor": "#ce93d8",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roundness": { "type": 3 }
    },
    {
      "type": "text",
      "id": "preprocess-title-1",
      "x": 220,
      "y": 330,
      "width": 360,
      "height": 25,
      "fontSize": 16,
      "fontFamily": 1,
      "text": "Query Preprocessing (Gemini AI)",
      "textAlign": "center",
      "strokeColor": "#4a148c",
      "fontWeight": "bold"
    },
    {
      "type": "text",
      "id": "preprocess-details-1",
      "x": 220,
      "y": 360,
      "width": 360,
      "height": 50,
      "fontSize": 11,
      "fontFamily": 1,
      "text": "• Expand abbreviations\n• Add synonyms (merge → join, concatenate)\n• Result: \"merge join concatenate DataFrames\"",
      "textAlign": "left",
      "strokeColor": "#4a148c"
    },
    {
      "type": "arrow",
      "id": "arrow-split-1",
      "x": 400,
      "y": 420,
      "width": 0,
      "height": 30,
      "strokeColor": "#1e88e5",
      "strokeWidth": 2,
      "startArrowhead": null,
      "endArrowhead": "arrow",
      "points": [[0, 0], [0, 30]]
    },
    {
      "type": "arrow",
      "id": "split-left-1",
      "x": 400,
      "y": 450,
      "width": -150,
      "height": 0,
      "strokeColor": "#43a047",
      "strokeWidth": 2,
      "startArrowhead": null,
      "endArrowhead": "arrow",
      "points": [[0, 0], [-150, 0]]
    },
    {
      "type": "arrow",
      "id": "split-right-1",
      "x": 400,
      "y": 450,
      "width": 150,
      "height": 0,
      "strokeColor": "#fb8c00",
      "strokeWidth": 2,
      "startArrowhead": null,
      "endArrowhead": "arrow",
      "points": [[0, 0], [150, 0]]
    },
    {
      "type": "rectangle",
      "id": "semantic-box-1",
      "x": 100,
      "y": 480,
      "width": 250,
      "height": 120,
      "strokeColor": "#43a047",
      "backgroundColor": "#c8e6c9",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roundness": { "type": 3 }
    },
    {
      "type": "text",
      "id": "semantic-title-1",
      "x": 120,
      "y": 490,
      "width": 210,
      "height": 20,
      "fontSize": 15,
      "fontFamily": 1,
      "text": "Semantic Search",
      "textAlign": "center",
      "strokeColor": "#2e7d32",
      "fontWeight": "bold"
    },
    {
      "type": "text",
      "id": "semantic-details-1",
      "x": 120,
      "y": 515,
      "width": 210,
      "height": 75,
      "fontSize": 11,
      "fontFamily": 1,
      "text": "• Vector embeddings\n• 768-dim similarity\n• Top 10 results\n• Filter: score ≥ 0.7\n• Returns: Doc A(0.85),\n  B(0.78), C(0.72)",
      "textAlign": "left",
      "strokeColor": "#2e7d32"
    },
    {
      "type": "rectangle",
      "id": "keyword-box-1",
      "x": 450,
      "y": 480,
      "width": 250,
      "height": 120,
      "strokeColor": "#fb8c00",
      "backgroundColor": "#ffe0b2",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roundness": { "type": 3 }
    },
    {
      "type": "text",
      "id": "keyword-title-1",
      "x": 470,
      "y": 490,
      "width": 210,
      "height": 20,
      "fontSize": 15,
      "fontFamily": 1,
      "text": "Keyword Search",
      "textAlign": "center",
      "strokeColor": "#e65100",
      "fontWeight": "bold"
    },
    {
      "type": "text",
      "id": "keyword-details-1",
      "x": 470,
      "y": 515,
      "width": 210,
      "height": 75,
      "fontSize": 11,
      "fontFamily": 1,
      "text": "• PostgreSQL FTS\n• Token matching\n• Top 5 results\n• Score: 0.5 default\n• Returns: Doc A(dup),\n  F, G, H",
      "textAlign": "left",
      "strokeColor": "#e65100"
    },
    {
      "type": "arrow",
      "id": "merge-left-1",
      "x": 225,
      "y": 600,
      "width": 125,
      "height": 30,
      "strokeColor": "#1e88e5",
      "strokeWidth": 2,
      "startArrowhead": null,
      "endArrowhead": "arrow",
      "points": [[0, 0], [125, 30]]
    },
    {
      "type": "arrow",
      "id": "merge-right-1",
      "x": 575,
      "y": 600,
      "width": -125,
      "height": 30,
      "strokeColor": "#1e88e5",
      "strokeWidth": 2,
      "startArrowhead": null,
      "endArrowhead": "arrow",
      "points": [[0, 0], [-125, 30]]
    },
    {
      "type": "rectangle",
      "id": "dedup-box-1",
      "x": 200,
      "y": 650,
      "width": 400,
      "height": 80,
      "strokeColor": "#8e24aa",
      "backgroundColor": "#e1bee7",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roundness": { "type": 3 }
    },
    {
      "type": "text",
      "id": "dedup-title-1",
      "x": 220,
      "y": 660,
      "width": 360,
      "height": 20,
      "fontSize": 16,
      "fontFamily": 1,
      "text": "Deduplication & Merge",
      "textAlign": "center",
      "strokeColor": "#4a148c",
      "fontWeight": "bold"
    },
    {
      "type": "text",
      "id": "dedup-details-1",
      "x": 220,
      "y": 685,
      "width": 360,
      "height": 35,
      "fontSize": 11,
      "fontFamily": 1,
      "text": "Remove duplicates (Doc A)\nSort by score → A(0.85), B(0.78), C(0.72),\nF(0.5), G(0.5), H(0.5)",
      "textAlign": "left",
      "strokeColor": "#4a148c"
    },
    {
      "type": "arrow",
      "id": "final-arrow-1",
      "x": 400,
      "y": 730,
      "width": 0,
      "height": 30,
      "strokeColor": "#1e88e5",
      "strokeWidth": 2,
      "startArrowhead": null,
      "endArrowhead": "arrow",
      "points": [[0, 0], [0, 30]]
    },
    {
      "type": "rectangle",
      "id": "result-box-1",
      "x": 200,
      "y": 780,
      "width": 400,
      "height": 100,
      "strokeColor": "#d32f2f",
      "backgroundColor": "#ffcdd2",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roundness": { "type": 3 }
    },
    {
      "type": "text",
      "id": "result-title-1",
      "x": 220,
      "y": 790,
      "width": 360,
      "height": 20,
      "fontSize": 16,
      "fontFamily": 1,
      "text": "Final Sorted Results",
      "textAlign": "center",
      "strokeColor": "#b71c1c",
      "fontWeight": "bold"
    },
    {
      "type": "text",
      "id": "result-details-1",
      "x": 220,
      "y": 815,
      "width": 360,
      "height": 55,
      "fontSize": 11,
      "fontFamily": 1,
      "text": "1. Doc A: 0.85 (semantic)\n2. Doc B: 0.78 (semantic)\n3. Doc C: 0.72 (semantic)\n4. Doc F, G, H: 0.5 (keyword)\n→ Sent to LLM as context",
      "textAlign": "left",
      "strokeColor": "#b71c1c"
    },
    {
      "type": "arrow",
      "id": "to-llm-1",
      "x": 400,
      "y": 880,
      "width": 0,
      "height": 30,
      "strokeColor": "#1e88e5",
      "strokeWidth": 3,
      "startArrowhead": null,
      "endArrowhead": "arrow",
      "points": [[0, 0], [0, 30]]
    },
    {
      "type": "rectangle",
      "id": "llm-box-1",
      "x": 200,
      "y": 930,
      "width": 400,
      "height": 60,
      "strokeColor": "#00897b",
      "backgroundColor": "#b2dfdb",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roundness": { "type": 3 }
    },
    {
      "type": "text",
      "id": "llm-text-1",
      "x": 220,
      "y": 945,
      "width": 360,
      "height": 30,
      "fontSize": 14,
      "fontFamily": 1,
      "text": "Gemini LLM generates response\nusing retrieved context",
      "textAlign": "center",
      "strokeColor": "#004d40",
      "fontWeight": "bold"
    },
    {
      "type": "rectangle",
      "id": "section2-border",
      "x": 800,
      "y": 100,
      "width": 700,
      "height": 2600,
      "strokeColor": "#1976d2",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 4,
      "roundness": { "type": 3 },
      "strokeStyle": "dashed"
    },
    {
      "type": "text",
      "id": "section2-title",
      "x": 850,
      "y": 120,
      "width": 600,
      "height": 40,
      "fontSize": 32,
      "fontFamily": 1,
      "text": "DIAGRAM 2: Database & Embeddings",
      "textAlign": "center",
      "strokeColor": "#0d47a1",
      "fontWeight": "bold",
      "backgroundColor": "#bbdefb"
    },
    {
      "type": "text",
      "id": "ingestion-title-2",
      "x": 850,
      "y": 200,
      "width": 600,
      "height": 30,
      "fontSize": 24,
      "fontFamily": 1,
      "text": "Data Ingestion Process",
      "textAlign": "center",
      "strokeColor": "#e65100",
      "fontWeight": "bold"
    },
    {
      "type": "rectangle",
      "id": "raw-docs-2",
      "x": 850,
      "y": 250,
      "width": 180,
      "height": 100,
      "strokeColor": "#fb8c00",
      "backgroundColor": "#ffe0b2",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roundness": { "type": 3 }
    },
    {
      "type": "text",
      "id": "raw-docs-title-2",
      "x": 860,
      "y": 260,
      "width": 160,
      "height": 20,
      "fontSize": 14,
      "fontFamily": 1,
      "text": "1. Raw Docs",
      "textAlign": "center",
      "strokeColor": "#e65100",
      "fontWeight": "bold"
    },
    {
      "type": "text",
      "id": "raw-docs-details-2",
      "x": 860,
      "y": 285,
      "width": 160,
      "height": 55,
      "fontSize": 10,
      "fontFamily": 1,
      "text": "backend/data/\n• 10min.txt\n• dsintro.txt\n• missing_data.txt",
      "textAlign": "left",
      "strokeColor": "#e65100"
    },
    {
      "type": "arrow",
      "id": "arrow1-2",
      "x": 1030,
      "y": 300,
      "width": 30,
      "height": 0,
      "strokeColor": "#1e88e5",
      "strokeWidth": 2,
      "startArrowhead": null,
      "endArrowhead": "arrow",
      "points": [[0, 0], [30, 0]]
    },
    {
      "type": "rectangle",
      "id": "loader-2",
      "x": 1080,
      "y": 250,
      "width": 180,
      "height": 100,
      "strokeColor": "#43a047",
      "backgroundColor": "#c8e6c9",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roundness": { "type": 3 }
    },
    {
      "type": "text",
      "id": "loader-title-2",
      "x": 1090,
      "y": 260,
      "width": 160,
      "height": 20,
      "fontSize": 14,
      "fontFamily": 1,
      "text": "2. Load",
      "textAlign": "center",
      "strokeColor": "#2e7d32",
      "fontWeight": "bold"
    },
    {
      "type": "text",
      "id": "loader-details-2",
      "x": 1090,
      "y": 285,
      "width": 160,
      "height": 55,
      "fontSize": 10,
      "fontFamily": 1,
      "text": "DirectoryLoader\nReads .txt files\nCreates Document\nobjects",
      "textAlign": "left",
      "strokeColor": "#2e7d32"
    },
    {
      "type": "arrow",
      "id": "arrow2-2",
      "x": 1260,
      "y": 300,
      "width": 30,
      "height": 0,
      "strokeColor": "#1e88e5",
      "strokeWidth": 2,
      "startArrowhead": null,
      "endArrowhead": "arrow",
      "points": [[0, 0], [30, 0]]
    },
    {
      "type": "rectangle",
      "id": "splitter-2",
      "x": 1310,
      "y": 250,
      "width": 180,
      "height": 100,
      "strokeColor": "#7b1fa2",
      "backgroundColor": "#ce93d8",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roundness": { "type": 3 }
    },
    {
      "type": "text",
      "id": "splitter-title-2",
      "x": 1320,
      "y": 260,
      "width": 160,
      "height": 20,
      "fontSize": 14,
      "fontFamily": 1,
      "text": "3. Chunk",
      "textAlign": "center",
      "strokeColor": "#4a148c",
      "fontWeight": "bold"
    },
    {
      "type": "text",
      "id": "splitter-details-2",
      "x": 1320,
      "y": 285,
      "width": 160,
      "height": 55,
      "fontSize": 10,
      "fontFamily": 1,
      "text": "500 chars/chunk\n50 char overlap\nSplit long docs",
      "textAlign": "left",
      "strokeColor": "#4a148c"
    },
    {
      "type": "arrow",
      "id": "arrow3-2",
      "x": 1150,
      "y": 350,
      "width": 0,
      "height": 30,
      "strokeColor": "#1e88e5",
      "strokeWidth": 2,
      "startArrowhead": null,
      "endArrowhead": "arrow",
      "points": [[0, 0], [0, 30]]
    },
    {
      "type": "rectangle",
      "id": "embedding-2",
      "x": 950,
      "y": 400,
      "width": 400,
      "height": 120,
      "strokeColor": "#00897b",
      "backgroundColor": "#b2dfdb",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roundness": { "type": 3 }
    },
    {
      "type": "text",
      "id": "embedding-title-2",
      "x": 970,
      "y": 410,
      "width": 360,
      "height": 20,
      "fontSize": 16,
      "fontFamily": 1,
      "text": "4. Generate Embeddings",
      "textAlign": "center",
      "strokeColor": "#004d40",
      "fontWeight": "bold"
    },
    {
      "type": "text",
      "id": "embedding-details-2",
      "x": 970,
      "y": 435,
      "width": 360,
      "height": 75,
      "fontSize": 11,
      "fontFamily": 1,
      "text": "Google Embedding-001\nEach chunk → 768-dim vector\nExample: [0.023, -0.145, 0.892, ...]\nCaptures semantic meaning",
      "textAlign": "left",
      "strokeColor": "#004d40"
    },
    {
      "type": "arrow",
      "id": "arrow4-2",
      "x": 1150,
      "y": 520,
      "width": 0,
      "height": 30,
      "strokeColor": "#1e88e5",
      "strokeWidth": 2,
      "startArrowhead": null,
      "endArrowhead": "arrow",
      "points": [[0, 0], [0, 30]]
    },
    {
      "type": "rectangle",
      "id": "storage-2",
      "x": 950,
      "y": 570,
      "width": 400,
      "height": 100,
      "strokeColor": "#d32f2f",
      "backgroundColor": "#ffcdd2",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roundness": { "type": 3 }
    },
    {
      "type": "text",
      "id": "storage-title-2",
      "x": 970,
      "y": 580,
      "width": 360,
      "height": 20,
      "fontSize": 16,
      "fontFamily": 1,
      "text": "5. Store in PostgreSQL",
      "textAlign": "center",
      "strokeColor": "#b71c1c",
      "fontWeight": "bold"
    },
    {
      "type": "text",
      "id": "storage-details-2",
      "x": 970,
      "y": 605,
      "width": 360,
      "height": 55,
      "fontSize": 11,
      "fontFamily": 1,
      "text": "PGVectorStore → 'docs' table\nColumns: content, embedding (vector),\nlangchain_id, langchain_metadata",
      "textAlign": "left",
      "strokeColor": "#b71c1c"
    },
    {
      "type": "text",
      "id": "db-schema-title-2",
      "x": 850,
      "y": 720,
      "width": 600,
      "height": 30,
      "fontSize": 24,
      "fontFamily": 1,
      "text": "Database Schema",
      "textAlign": "center",
      "strokeColor": "#1976d2",
      "fontWeight": "bold"
    },
    {
      "type": "rectangle",
      "id": "postgres-box-2",
      "x": 850,
      "y": 770,
      "width": 600,
      "height": 40,
      "strokeColor": "#1976d2",
      "backgroundColor": "#bbdefb",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roundness": { "type": 3 }
    },
    {
      "type": "text",
      "id": "postgres-text-2",
      "x": 870,
      "y": 780,
      "width": 560,
      "height": 20,
      "fontSize": 16,
      "fontFamily": 1,
      "text": "PostgreSQL + pgvector extension",
      "textAlign": "center",
      "strokeColor": "#0d47a1",
      "fontWeight": "bold"
    },
    {
      "type": "rectangle",
      "id": "docs-table-2",
      "x": 870,
      "y": 840,
      "width": 270,
      "height": 280,
      "strokeColor": "#00897b",
      "backgroundColor": "#b2dfdb",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roundness": { "type": 3 }
    },
    {
      "type": "text",
      "id": "docs-title-2",
      "x": 890,
      "y": 850,
      "width": 230,
      "height": 25,
      "fontSize": 18,
      "fontFamily": 1,
      "text": "TABLE: docs",
      "textAlign": "center",
      "strokeColor": "#004d40",
      "fontWeight": "bold"
    },
    {
      "type": "text",
      "id": "docs-schema-2",
      "x": 890,
      "y": 880,
      "width": 230,
      "height": 230,
      "fontSize": 11,
      "fontFamily": 1,
      "text": "content (TEXT)\n→ The chunk text\n\nembedding (VECTOR(768))\n→ 768-dim vector\n→ Indexed (HNSW/IVFFlat)\n\nlangchain_id (UUID)\n→ Primary key\n\nlangchain_metadata (JSONB)\n→ {source, chunk #}\n\nUsed for: Vector search",
      "textAlign": "left",
      "strokeColor": "#004d40"
    },
    {
      "type": "rectangle",
      "id": "chat-table-2",
      "x": 1170,
      "y": 840,
      "width": 270,
      "height": 280,
      "strokeColor": "#fb8c00",
      "backgroundColor": "#ffe0b2",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roundness": { "type": 3 }
    },
    {
      "type": "text",
      "id": "chat-title-2",
      "x": 1190,
      "y": 850,
      "width": 230,
      "height": 25,
      "fontSize": 18,
      "fontFamily": 1,
      "text": "TABLE: chat_history",
      "textAlign": "center",
      "strokeColor": "#e65100",
      "fontWeight": "bold"
    },
    {
      "type": "text",
      "id": "chat-schema-2",
      "x": 1190,
      "y": 880,
      "width": 230,
      "height": 230,
      "fontSize": 11,
      "fontFamily": 1,
      "text": "id (SERIAL)\n→ Primary key\n\nsession_id (VARCHAR)\n→ User session UUID\n→ Indexed\n\nprompt (TEXT)\n→ User question\n\nresponse (TEXT)\n→ AI answer\n\ntimestamp (TIMESTAMP)\n→ When sent\n\nUsed for: Context memory",
      "textAlign": "left",
      "strokeColor": "#e65100"
    },
    {
      "type": "text",
      "id": "retrieval-title-2",
      "x": 850,
      "y": 1160,
      "width": 600,
      "height": 30,
      "fontSize": 24,
      "fontFamily": 1,
      "text": "How Retrieval Works",
      "textAlign": "center",
      "strokeColor": "#7b1fa2",
      "fontWeight": "bold"
    },
    {
      "type": "rectangle",
      "id": "query-emb-2",
      "x": 870,
      "y": 1210,
      "width": 250,
      "height": 100,
      "strokeColor": "#7b1fa2",
      "backgroundColor": "#ce93d8",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roundness": { "type": 3 }
    },
    {
      "type": "text",
      "id": "query-emb-title-2",
      "x": 890,
      "y": 1220,
      "width": 210,
      "height": 20,
      "fontSize": 15,
      "fontFamily": 1,
      "text": "User Query → Embedding",
      "textAlign": "center",
      "strokeColor": "#4a148c",
      "fontWeight": "bold"
    },
    {
      "type": "text",
      "id": "query-emb-details-2",
      "x": 890,
      "y": 1245,
      "width": 210,
      "height": 55,
      "fontSize": 10,
      "fontFamily": 1,
      "text": "\"merge DataFrames\"\n↓\nConvert to 768-dim vector\n↓\n[0.156, -0.234, ...]",
      "textAlign": "left",
      "strokeColor": "#4a148c"
    },
    {
      "type": "arrow",
      "id": "arrow5-2",
      "x": 1120,
      "y": 1260,
      "width": 30,
      "height": 0,
      "strokeColor": "#1e88e5",
      "strokeWidth": 2,
      "startArrowhead": null,
      "endArrowhead": "arrow",
      "points": [[0, 0], [30, 0]]
    },
    {
      "type": "rectangle",
      "id": "similarity-2",
      "x": 1170,
      "y": 1210,
      "width": 270,
      "height": 100,
      "strokeColor": "#43a047",
      "backgroundColor": "#c8e6c9",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roundness": { "type": 3 }
    },
    {
      "type": "text",
      "id": "similarity-title-2",
      "x": 1190,
      "y": 1220,
      "width": 230,
      "height": 20,
      "fontSize": 15,
      "fontFamily": 1,
      "text": "Vector Similarity Search",
      "textAlign": "center",
      "strokeColor": "#2e7d32",
      "fontWeight": "bold"
    },
    {
      "type": "text",
      "id": "similarity-details-2",
      "x": 1190,
      "y": 1245,
      "width": 230,
      "height": 55,
      "fontSize": 10,
      "fontFamily": 1,
      "text": "Cosine similarity (pgvector)\nFast HNSW/IVFFlat index\nReturns top 10 with scores\nO(log n) complexity",
      "textAlign": "left",
      "strokeColor": "#2e7d32"
    },
    {
      "type": "rectangle",
      "id": "keyword-search-2",
      "x": 870,
      "y": 1340,
      "width": 270,
      "height": 100,
      "strokeColor": "#fb8c00",
      "backgroundColor": "#ffe0b2",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roundness": { "type": 3 }
    },
    {
      "type": "text",
      "id": "keyword-title-2",
      "x": 890,
      "y": 1350,
      "width": 230,
      "height": 20,
      "fontSize": 15,
      "fontFamily": 1,
      "text": "Full-Text Search",
      "textAlign": "center",
      "strokeColor": "#e65100",
      "fontWeight": "bold"
    },
    {
      "type": "text",
      "id": "keyword-details-2",
      "x": 890,
      "y": 1375,
      "width": 230,
      "height": 55,
      "fontSize": 10,
      "fontFamily": 1,
      "text": "to_tsvector / plainto_tsquery\nExact token matching\nFast GIN index\nReturns top 5 results",
      "textAlign": "left",
      "strokeColor": "#e65100"
    },
    {
      "type": "rectangle",
      "id": "combined-2",
      "x": 1170,
      "y": 1340,
      "width": 270,
      "height": 100,
      "strokeColor": "#d32f2f",
      "backgroundColor": "#ffcdd2",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roundness": { "type": 3 }
    },
    {
      "type": "text",
      "id": "combined-title-2",
      "x": 1190,
      "y": 1350,
      "width": 230,
      "height": 20,
      "fontSize": 15,
      "fontFamily": 1,
      "text": "Combined Results",
      "textAlign": "center",
      "strokeColor": "#b71c1c",
      "fontWeight": "bold"
    },
    {
      "type": "text",
      "id": "combined-details-2",
      "x": 1190,
      "y": 1375,
      "width": 230,
      "height": 55,
      "fontSize": 10,
      "fontFamily": 1,
      "text": "Merge + deduplicate\nFilter by relevance ≥0.7\nSort by score\nReturn to LLM",
      "textAlign": "left",
      "strokeColor": "#b71c1c"
    },
    {
      "type": "text",
      "id": "perf-title-2",
      "x": 850,
      "y": 1480,
      "width": 600,
      "height": 30,
      "fontSize": 24,
      "fontFamily": 1,
      "text": "Performance & Indexing",
      "textAlign": "center",
      "strokeColor": "#1976d2",
      "fontWeight": "bold"
    },
    {
      "type": "rectangle",
      "id": "indexes-2",
      "x": 870,
      "y": 1530,
      "width": 570,
      "height": 150,
      "strokeColor": "#1976d2",
      "backgroundColor": "#bbdefb",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roundness": { "type": 3 }
    },
    {
      "type": "text",
      "id": "indexes-title-2",
      "x": 890,
      "y": 1540,
      "width": 530,
      "height": 20,
      "fontSize": 16,
      "fontFamily": 1,
      "text": "Database Indexes",
      "textAlign": "center",
      "strokeColor": "#0d47a1",
      "fontWeight": "bold"
    },
    {
      "type": "text",
      "id": "indexes-details-2",
      "x": 890,
      "y": 1565,
      "width": 530,
      "height": 105,
      "fontSize": 11,
      "fontFamily": 1,
      "text": "1. Vector Index (docs.embedding)\n   Type: HNSW or IVFFlat | Speed: O(log n) | For: Similarity search\n\n2. Full-Text Index (docs.content)\n   Type: GIN on to_tsvector | Speed: O(log n) | For: Keyword search\n\n3. Session Index (chat_history.session_id)\n   Type: B-tree | Speed: O(log n) | For: History retrieval\n\nResult: Fast queries even with 10,000+ chunks (100-300ms)",
      "textAlign": "left",
      "strokeColor": "#0d47a1"
    },
    {
      "type": "rectangle",
      "id": "section3-border",
      "x": 50,
      "y": 1400,
      "width": 700,
      "height": 1300,
      "strokeColor": "#7b1fa2",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 4,
      "roundness": { "type": 3 },
      "strokeStyle": "dashed"
    },
    {
      "type": "text",
      "id": "section3-title",
      "x": 100,
      "y": 1420,
      "width": 600,
      "height": 40,
      "fontSize": 32,
      "fontFamily": 1,
      "text": "DIAGRAM 3: Complete AI Flow",
      "textAlign": "center",
      "strokeColor": "#4a148c",
      "fontWeight": "bold",
      "backgroundColor": "#f3e5f5"
    },
    {
      "type": "rectangle",
      "id": "frontend-3",
      "x": 100,
      "y": 1490,
      "width": 600,
      "height": 120,
      "strokeColor": "#9c27b0",
      "backgroundColor": "#e1bee7",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roundness": { "type": 3 }
    },
    {
      "type": "text",
      "id": "frontend-title-3",
      "x": 120,
      "y": 1500,
      "width": 560,
      "height": 25,
      "fontSize": 18,
      "fontFamily": 1,
      "text": "FRONTEND (Next.js/React)",
      "textAlign": "center",
      "strokeColor": "#4a148c",
      "fontWeight": "bold"
    },
    {
      "type": "text",
      "id": "frontend-details-3",
      "x": 120,
      "y": 1530,
      "width": 560,
      "height": 70,
      "fontSize": 11,
      "fontFamily": 1,
      "text": "1. User types query in chat UI\n2. Generate/check sessionId (localStorage)\n3. POST to /ai: {query, sessionId}\n4. Receive streaming response\n5. Display with syntax highlighting\n6. Auto-scroll to latest message",
      "textAlign": "left",
      "strokeColor": "#4a148c"
    },
    {
      "type": "arrow",
      "id": "arrow-backend-3",
      "x": 400,
      "y": 1610,
      "width": 0,
      "height": 30,
      "strokeColor": "#1e88e5",
      "strokeWidth": 3,
      "startArrowhead": null,
      "endArrowhead": "arrow",
      "points": [[0, 0], [0, 30]]
    },
    {
      "type": "rectangle",
      "id": "backend-entry-3",
      "x": 100,
      "y": 1660,
      "width": 600,
      "height": 100,
      "strokeColor": "#00897b",
      "backgroundColor": "#b2dfdb",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roundness": { "type": 3 }
    },
    {
      "type": "text",
      "id": "backend-title-3",
      "x": 120,
      "y": 1670,
      "width": 560,
      "height": 20,
      "fontSize": 16,
      "fontFamily": 1,
      "text": "@app.post(\"/ai\") - Backend Entry Point",
      "textAlign": "center",
      "strokeColor": "#004d40",
      "fontWeight": "bold"
    },
    {
      "type": "text",
      "id": "backend-details-3",
      "x": 120,
      "y": 1695,
      "width": 560,
      "height": 55,
      "fontSize": 11,
      "fontFamily": 1,
      "text": "Receives: {query, sessionId}\nSpawns 2 parallel async tasks:\n  • hybrid_search(query, db)\n  • get_formatted_history(sessionId, db)\nWaits for both with asyncio.gather()",
      "textAlign": "left",
      "strokeColor": "#004d40"
    },
    {
      "type": "arrow",
      "id": "split-3",
      "x": 400,
      "y": 1760,
      "width": 0,
      "height": 30,
      "strokeColor": "#1e88e5",
      "strokeWidth": 2,
      "startArrowhead": null,
      "endArrowhead": "arrow",
      "points": [[0, 0], [0, 30]]
    },
    {
      "type": "rectangle",
      "id": "hybrid-search-3",
      "x": 100,
      "y": 1810,
      "width": 600,
      "height": 80,
      "strokeColor": "#43a047",
      "backgroundColor": "#c8e6c9",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roundness": { "type": 3 }
    },
    {
      "type": "text",
      "id": "hybrid-title-3",
      "x": 120,
      "y": 1820,
      "width": 560,
      "height": 20,
      "fontSize": 16,
      "fontFamily": 1,
      "text": "Hybrid Search (See Diagram 1 for details)",
      "textAlign": "center",
      "strokeColor": "#2e7d32",
      "fontWeight": "bold"
    },
    {
      "type": "text",
      "id": "hybrid-details-3",
      "x": 120,
      "y": 1845,
      "width": 560,
      "height": 35,
      "fontSize": 11,
      "fontFamily": 1,
      "text": "Preprocess → Semantic + Keyword → Deduplicate → Sort\nReturns: Top docs with scores",
      "textAlign": "left",
      "strokeColor": "#2e7d32"
    },
    {
      "type": "arrow",
      "id": "arrow-prompt-3",
      "x": 400,
      "y": 1890,
      "width": 0,
      "height": 30,
      "strokeColor": "#1e88e5",
      "strokeWidth": 2,
      "startArrowhead": null,
      "endArrowhead": "arrow",
      "points": [[0, 0], [0, 30]]
    },
    {
      "type": "rectangle",
      "id": "prompt-build-3",
      "x": 100,
      "y": 1940,
      "width": 600,
      "height": 100,
      "strokeColor": "#00897b",
      "backgroundColor": "#b2dfdb",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roundness": { "type": 3 }
    },
    {
      "type": "text",
      "id": "prompt-title-3",
      "x": 120,
      "y": 1950,
      "width": 560,
      "height": 20,
      "fontSize": 16,
      "fontFamily": 1,
      "text": "Build Final Prompt",
      "textAlign": "center",
      "strokeColor": "#004d40",
      "fontWeight": "bold"
    },
    {
      "type": "text",
      "id": "prompt-details-3",
      "x": 120,
      "y": 1975,
      "width": 560,
      "height": 55,
      "fontSize": 11,
      "fontFamily": 1,
      "text": "Combine:\n  • Original query (user question)\n  • Retrieved docs (knowledge)\n  • Chat history (last 10 messages)\nInject into PROMPT_TEMPLATE (3 modes: Knowledge/Code/Social)",
      "textAlign": "left",
      "strokeColor": "#004d40"
    },
    {
      "type": "arrow",
      "id": "arrow-llm-3",
      "x": 400,
      "y": 2040,
      "width": 0,
      "height": 30,
      "strokeColor": "#1e88e5",
      "strokeWidth": 3,
      "startArrowhead": null,
      "endArrowhead": "arrow",
      "points": [[0, 0], [0, 30]]
    },
    {
      "type": "rectangle",
      "id": "llm-gen-3",
      "x": 100,
      "y": 2090,
      "width": 600,
      "height": 100,
      "strokeColor": "#673ab7",
      "backgroundColor": "#d1c4e9",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roundness": { "type": 3 }
    },
    {
      "type": "text",
      "id": "llm-gen-title-3",
      "x": 120,
      "y": 2100,
      "width": 560,
      "height": 20,
      "fontSize": 16,
      "fontFamily": 1,
      "text": "Gemini LLM Response Generation",
      "textAlign": "center",
      "strokeColor": "#311b92",
      "fontWeight": "bold"
    },
    {
      "type": "text",
      "id": "llm-gen-details-3",
      "x": 120,
      "y": 2125,
      "width": 560,
      "height": 55,
      "fontSize": 11,
      "fontFamily": 1,
      "text": "llm.stream(prompt) - Gemini 1.5 Flash (temp=0)\nGenerates response chunk-by-chunk\nEach chunk sent immediately to frontend\nFull response accumulated for saving",
      "textAlign": "left",
      "strokeColor": "#311b92"
    },
    {
      "type": "arrow",
      "id": "arrow-stream-3",
      "x": 400,
      "y": 2190,
      "width": 0,
      "height": 30,
      "strokeColor": "#1e88e5",
      "strokeWidth": 3,
      "startArrowhead": null,
      "endArrowhead": "arrow",
      "points": [[0, 0], [0, 30]]
    },
    {
      "type": "rectangle",
      "id": "streaming-3",
      "x": 100,
      "y": 2240,
      "width": 600,
      "height": 100,
      "strokeColor": "#f57c00",
      "backgroundColor": "#ffe0b2",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roundness": { "type": 3 }
    },
    {
      "type": "text",
      "id": "streaming-title-3",
      "x": 120,
      "y": 2250,
      "width": 560,
      "height": 20,
      "fontSize": 16,
      "fontFamily": 1,
      "text": "Stream to Frontend + Save History",
      "textAlign": "center",
      "strokeColor": "#e65100",
      "fontWeight": "bold"
    },
    {
      "type": "text",
      "id": "streaming-details-3",
      "x": 120,
      "y": 2275,
      "width": 560,
      "height": 55,
      "fontSize": 11,
      "fontFamily": 1,
      "text": "StreamingResponse sends chunks to frontend\nFrontend updates UI in real-time\nAfter complete: Save to chat_history table\n  ChatHistory(session_id, prompt, response, timestamp)",
      "textAlign": "left",
      "strokeColor": "#e65100"
    },
    {
      "type": "arrow",
      "id": "arrow-display-3",
      "x": 400,
      "y": 2340,
      "width": 0,
      "height": 30,
      "strokeColor": "#1e88e5",
      "strokeWidth": 3,
      "startArrowhead": null,
      "endArrowhead": "arrow",
      "points": [[0, 0], [0, 30]]
    },
    {
      "type": "rectangle",
      "id": "display-3",
      "x": 100,
      "y": 2390,
      "width": 600,
      "height": 100,
      "strokeColor": "#9c27b0",
      "backgroundColor": "#e1bee7",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roundness": { "type": 3 }
    },
    {
      "type": "text",
      "id": "display-title-3",
      "x": 120,
      "y": 2400,
      "width": 560,
      "height": 20,
      "fontSize": 16,
      "fontFamily": 1,
      "text": "Display in Chat UI",
      "textAlign": "center",
      "strokeColor": "#4a148c",
      "fontWeight": "bold"
    },
    {
      "type": "text",
      "id": "display-details-3",
      "x": 120,
      "y": 2425,
      "width": 560,
      "height": 55,
      "fontSize": 11,
      "fontFamily": 1,
      "text": "Frontend receives chunks via ReadableStream\nUpdates AI message in real-time (typing effect)\nApplies syntax highlighting for code blocks\nAuto-scrolls to latest message\n✓ User sees complete AI response!",
      "textAlign": "left",
      "strokeColor": "#4a148c"
    },
    {
      "type": "text",
      "id": "summary-note",
      "x": 100,
      "y": 2530,
      "width": 600,
      "height": 30,
      "fontSize": 16,
      "fontFamily": 1,
      "text": "Total Time: 2-4 seconds | First chunk: 1-2 seconds",
      "textAlign": "center",
      "strokeColor": "#2e7d32",
      "fontWeight": "bold",
      "backgroundColor": "#c8e6c9"
    }
  ],
  "appState": {
    "gridSize": null,
    "viewBackgroundColor": "#ffffff"
  },
  "files": {}
}
